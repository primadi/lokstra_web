<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{.Title}} - Lokstra Framework</title>

    <!-- Lokstra Theme CSS -->
    <link rel="stylesheet" href="/components/theme.css">
    
    <!-- Dashboard-specific CSS -->
    <link rel="stylesheet" href="/static/css/dashboard.css">

    <script src="/static/js/init-loader.js"></script>
    
    <!-- Import Lokstra App Root Component -->
    <script type="module" src="/components/app-root.js"></script>
    
    <!-- Alpine.js -->
    <!-- Prevent Alpine not loaded error -->
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
</head>

<body x-data="dashboard">
    <ls-app-root>
        <div class="mobile-overlay" id="mobileOverlay"></div>
        
        <div class="dashboard-layout">
            <!-- Sidebar -->
            <div class="sidebar-container" id="sidebarContainer">
                <ls-sidebar id="sidebar"></ls-sidebar>
            </div>
            
            <!-- Main Content -->
            <div class="main-content">
                <!-- Top Navigation -->
                <ls-navbar id="navbar"></ls-navbar>
                
                <!-- Page Content -->
                <div class="content-area" id="pageContent">
                    <!-- Page Header -->
                    <div class="page-header">
                        <div>
                            <h1 class="page-title">{{.Title}}</h1>
                            <p class="page-subtitle">{{.Subtitle}}</p>
                        </div>
                        
                        <div class="page-actions">
                            <ls-button text="New Project" variant="primary" icon="plus" hx-get="/projects/new" hx-target="#pageContent"></ls-button>
                            <ls-button text="Export Data" variant="outline" icon="download" hx-get="/api/export" hx-target="#dynamicContent"></ls-button>
                            <ls-button text="Settings" variant="outline" icon="settings" hx-get="/settings" hx-target="#pageContent"></ls-button>
                        </div>
                    </div>
                    
                    <!-- Stats Cards -->
                    <div class="stats-grid">
                        {{range .Stats}}
                        <div class="stat-card">
                            <div class="stat-header">
                                <span class="stat-title">{{.Title}}</span>
                                <div class="stat-icon">
                                    <ls-icon name="{{.Icon}}" size="1.25rem"></ls-icon>
                                </div>
                            </div>
                            <div class="stat-value">{{.Value}}</div>
                            <div class="stat-change {{.Type}}">
                                {{if eq .Type "positive"}}
                                    <ls-icon name="trending-up" size="1rem"></ls-icon>
                                {{else if eq .Type "negative"}}
                                    <ls-icon name="trending-down" size="1rem"></ls-icon>
                                {{else}}
                                    <ls-icon name="activity" size="1rem"></ls-icon>
                                {{end}}
                                {{.Change}}
                            </div>
                        </div>
                        {{end}}
                        {{if not .Stats}}
                        <!-- Default stats if no data provided -->
                        <div class="stat-card">
                            <div class="stat-header">
                                <span class="stat-title">Total Users</span>
                                <div class="stat-icon">
                                    <ls-icon name="users" size="1.25rem"></ls-icon>
                                </div>
                            </div>
                            <div class="stat-value">2,845</div>
                            <div class="stat-change positive">
                                <ls-icon name="trending-up" size="1rem"></ls-icon>
                                +12% from last month
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-header">
                                <span class="stat-title">Revenue</span>
                                <div class="stat-icon">
                                    <ls-icon name="dollar-sign" size="1.25rem"></ls-icon>
                                </div>
                            </div>
                            <div class="stat-value">$48,290</div>
                            <div class="stat-change positive">
                                <ls-icon name="trending-up" size="1rem"></ls-icon>
                                +8% from last month
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-header">
                                <span class="stat-title">Orders</span>
                                <div class="stat-icon">
                                    <ls-icon name="shopping-cart" size="1.25rem"></ls-icon>
                                </div>
                            </div>
                            <div class="stat-value">1,248</div>
                            <div class="stat-change negative">
                                <ls-icon name="trending-down" size="1rem"></ls-icon>
                                -3% from last month
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-header">
                                <span class="stat-title">Conversion</span>
                                <div class="stat-icon">
                                    <ls-icon name="target" size="1.25rem"></ls-icon>
                                </div>
                            </div>
                            <div class="stat-value">3.24%</div>
                            <div class="stat-change positive">
                                <ls-icon name="trending-up" size="1rem"></ls-icon>
                                +0.5% from last month
                            </div>
                        </div>
                        {{end}}
                    </div>
                    
                    <!-- Content Grid -->
                    <div class="content-grid">
                        <!-- Main Content Card -->
                        <div class="content-card">
                            <div class="card-header">
                                <h2 class="card-title">Recent Activity</h2>
                                <ls-button text="View All" variant="outline" size="sm" hx-get="/activity" hx-target="#pageContent"></ls-button>
                            </div>
                            
                            <div id="activityContent" style="background-color: var(--ls-card-bg); color: var(--ls-text-primary); border-radius: var(--ls-border-radius-lg);">
                                <p style="color: var(--ls-text-muted); text-align: center; padding: 2rem;">
                                    <ls-icon name="activity" size="2rem" style="margin-bottom: 0.5rem; display: block; margin: 0 auto 0.5rem;"></ls-icon>
                                    Loading recent activity...
                                </p>
                            </div>
                        </div>
                        
                        <!-- Sidebar Content Card -->
                        <div class="content-card">
                            <div class="card-header">
                                <h2 class="card-title">Quick Actions</h2>
                            </div>
                            
                            <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                                <!-- Quick Actions with ls-button components -->
                                <ls-button
                                    fullwidth
                                    text="Create User" 
                                    variant="outline" 
                                    size="sm" 
                                    icon="user-plus" 
                                    hx-get="/users/new" 
                                    hx-target="#pageContent">
                                </ls-button>
                                <ls-button
                                    fullwidth
                                    text="Generate Report" 
                                    variant="outline" 
                                    size="sm" 
                                    icon="file-text" 
                                    hx-get="/reports/new" 
                                    hx-target="#pageContent">
                                </ls-button>
                                <ls-button
                                    fullwidth
                                    text="Backup Data" 
                                    variant="outline" 
                                    size="sm" 
                                    icon="hard-drive">
                                </ls-button>
                                <ls-button
                                    fullwidth
                                    text="System Health" 
                                    variant="outline" 
                                    size="sm" 
                                    icon="activity" 
                                    hx-get="/system/health" 
                                    hx-target="#pageContent">
                                </ls-button>
                            </div>
                            
                            <div style="margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid var(--ls-border-primary);">
                                <h3 style="font-size: 0.875rem; font-weight: 600; color: var(--ls-text-muted); margin-bottom: 1rem;">System Status</h3>
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                    <span style="font-size: 0.875rem; color: var(--ls-text-muted);">Server</span>
                                    <span style="font-size: 0.875rem; color: var(--ls-success-600); display: flex; align-items: center; gap: 0.25rem;">
                                        <ls-icon name="check-circle" size="0.875rem"></ls-icon>
                                        Online
                                    </span>
                                </div>
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                    <span style="font-size: 0.875rem; color: var(--ls-text-muted);">Database</span>
                                    <span style="font-size: 0.875rem; color: var(--ls-success-600); display: flex; align-items: center; gap: 0.25rem;">
                                        <ls-icon name="check-circle" size="0.875rem"></ls-icon>
                                        Connected
                                    </span>
                                </div>
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <span style="font-size: 0.875rem; color: var(--ls-text-muted);">Storage</span>
                                    <span style="font-size: 0.875rem; color: var(--ls-warning-600);">78% used</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Additional Content Area for HTMX partial loading -->
                    <div id="dynamicContent">
                        <!-- Dynamic content loaded via HTMX will appear here -->
                    </div>
                </div>
                
                <!-- Footer -->
                <div class="footer">
                    © 2025 Lokstra Framework. Built with ❤️ using Lit Web Components, HTMX & Alpine.js.
                </div>
            </div>
        </div>
    </ls-app-root>
    </div>

    <script>
        // Alpine.js data for dashboard
        document.addEventListener('alpine:init', () => {
            Alpine.data('dashboard', () => ({
                init() {
                    console.log('Dashboard Alpine.js initialized');
                    // Initialize components after Alpine is ready
                    this.$nextTick(() => {
                        this.initializeComponents();
                        this.loadInitialContent();
                    });
                },
       
                initializeComponents() {
                    const sidebar = document.getElementById('sidebar');
                    const navbar = document.getElementById('navbar');
                    
                    if (sidebar) {
                        // Set sidebar menu items - SINGLE SOURCE OF TRUTH
                        sidebar.menuItems = this.getMenuItems();
                        sidebar.activeItem = 'dashboard'; // Set active item
                        console.log('Sidebar initialized with menu items');
                    }
                    
                    if (navbar) {
                        // Set navbar data - SINGLE SOURCE OF TRUTH
                        navbar.user = this.getUserData();
                        navbar.breadcrumb = this.getBreadcrumbData();
                        navbar.notificationCount = 3;
                        console.log('Navbar initialized with user data');
                    }
                },
                
                loadInitialContent() {
                    // Load activity content via HTMX
                    setTimeout(() => {
                        if (typeof htmx !== 'undefined') {
                            htmx.ajax('GET', '/api/activity', {
                                target: '#activityContent'
                            });
                        }
                    }, 1000);
                },
                
                // SINGLE SOURCE OF TRUTH untuk menu items
                getMenuItems() {
                    return [
                        {
                            title: 'Main',
                            items: [
                                { key: 'dashboard', title: 'Dashboard', icon: 'home', url: '/', active: true },
                                { key: 'analytics', title: 'Analytics', icon: 'bar-chart-3', url: '/analytics', hxGet: '/analytics', hxTarget: '#pageContent' }
                            ]
                        },
                        {
                            title: 'Management',
                            items: [
                                {
                                    key: 'users',
                                    title: 'Users',
                                    icon: 'users',
                                    submenu: [
                                        { key: 'users-list', title: 'All Users', url: '/users', hxGet: '/users', hxTarget: '#pageContent' },
                                        { key: 'users-new', title: 'Add User', url: '/users/new', hxGet: '/users/new', hxTarget: '#pageContent' },
                                        { key: 'users-roles', title: 'Roles', url: '/users/roles', hxGet: '/users/roles', hxTarget: '#pageContent' }
                                    ]
                                },
                                { key: 'projects', title: 'Projects', icon: 'folder', url: '/projects', badge: '12', hxGet: '/projects', hxTarget: '#pageContent' },
                                { key: 'reports', title: 'Reports', icon: 'file-text', url: '/reports', hxGet: '/reports', hxTarget: '#pageContent' }
                            ]
                        },
                        {
                            title: 'System',
                            items: [
                                { key: 'settings', title: 'Settings', icon: 'settings', url: '/settings', hxGet: '/settings', hxTarget: '#pageContent' },
                                { key: 'logs', title: 'Logs', icon: 'file-text', url: '/logs', hxGet: '/logs', hxTarget: '#pageContent' }
                            ]
                        }
                    ];
                },
                
                // SINGLE SOURCE OF TRUTH untuk user data
                getUserData() {
                    return {
                        name: 'John Doe',
                        role: 'Administrator',
                        avatar: null
                    };
                },
                
                // SINGLE SOURCE OF TRUTH untuk breadcrumb data
                getBreadcrumbData() {
                    return [
                        { title: 'Home', url: '/' },
                        { title: 'Dashboard', url: '/dashboard', active: true }
                    ];
                }
            }));
        });
        
        document.addEventListener('nav-item-click', (e) => {
            // Close mobile sidebar after navigation
            if (window.innerWidth <= 768) {
                document.getElementById('sidebarContainer').classList.remove('open');
                document.getElementById('mobileOverlay').classList.remove('show');
            }
        });
        
        // Close mobile sidebar when clicking overlay
        document.getElementById('mobileOverlay')?.addEventListener('click', () => {
            document.getElementById('sidebarContainer').classList.remove('open');
            document.getElementById('mobileOverlay').classList.remove('show');
        });
        
        // Handle window resize
        window.addEventListener('resize', () => {
            if (window.innerWidth > 768) {
                document.getElementById('sidebarContainer').classList.remove('open');
                document.getElementById('mobileOverlay').classList.remove('show');
            }
        });
    </script>
</body>
</html>
