import { LitElement, html, css } from 'lit';
import { customElement, property, state } from 'lit/decorators.js';

@customElement('ls-input')
export class LsInput extends LitElement {
  static styles = css`
    :host {
      display: block;
      position: relative;
      margin-bottom: 1rem;
    }

    .ls-input-label {
      display: block;
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--ls-input-label-color, #374151);
      margin-bottom: 0.5rem;
    }

    .ls-input-field {
      width: 100%;
      padding: 0.75rem 1rem;
      border: 1px solid var(--ls-input-border-color, #d1d5db);
      border-radius: var(--ls-input-border-radius, 0.5rem);
      background-color: var(--ls-input-bg-color, #ffffff);
      color: var(--ls-input-text-color, #374151);
      font-size: 1rem;
      box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
      transition: all 0.2s ease-in-out;
    }

    .ls-input-field:focus {
      outline: none;
      border-color: var(--ls-input-focus-border-color, #3b82f6);
      box-shadow: 0 0 0 2px var(--ls-input-focus-ring-color, rgba(59, 130, 246, 0.1));
    }

    .ls-input-field:disabled {
      background-color: var(--ls-input-disabled-bg-color, #f3f4f6);
      cursor: not-allowed;
      opacity: 0.6;
    }

    .ls-input-field.error {
      border-color: var(--ls-input-error-border-color, #ef4444);
    }

    .ls-input-field.error:focus {
      border-color: var(--ls-input-error-border-color, #ef4444);
      box-shadow: 0 0 0 2px var(--ls-input-error-ring-color, rgba(239, 68, 68, 0.1));
    }

    .ls-input-field.success {
      border-color: var(--ls-input-success-border-color, #10b981);
    }

    .ls-input-field.success:focus {
      border-color: var(--ls-input-success-border-color, #10b981);
      box-shadow: 0 0 0 2px var(--ls-input-success-ring-color, rgba(16, 185, 129, 0.1));
    }

    .ls-input-helper {
      margin-top: 0.25rem;
      font-size: 0.875rem;
      color: var(--ls-input-helper-color, #6b7280);
    }

    .ls-input-error-text {
      margin-top: 0.25rem;
      font-size: 0.875rem;
      color: var(--ls-input-error-text-color, #ef4444);
    }

    .required {
      color: var(--ls-input-required-color, #ef4444);
    }
  `;

  @property({ type: String }) label = '';
  @property({ type: String }) placeholder = '';
  @property({ type: String }) type = 'text';
  @property({ type: String }) value = '';
  @property({ type: String }) name = '';
  @property({ type: String }) helperText = '';
  @property({ type: String }) errorText = '';
  @property({ type: Boolean }) required = false;
  @property({ type: Boolean }) disabled = false;
  @property({ type: Boolean }) error = false;
  @property({ type: Boolean }) success = false;
  @property({ type: Boolean }) showLabel = true;
  @property({ type: String }) hxPost = '';
  @property({ type: String }) hxTrigger = '';
  @property({ type: String }) hxTarget = '';

  @state() private focused = false;

  private handleInput(e: Event) {
    const input = e.target as HTMLInputElement;
    this.value = input.value;
    this.dispatchEvent(new CustomEvent('input', {
      detail: { value: this.value },
      bubbles: true
    }));
  }

  private handleFocus() {
    this.focused = true;
    this.dispatchEvent(new CustomEvent('focus', { bubbles: true }));
  }

  private handleBlur() {
    this.focused = false;
    this.dispatchEvent(new CustomEvent('blur', { bubbles: true }));
  }

  render() {
    const inputClasses = [
      'ls-input-field',
      this.error ? 'error' : '',
      this.success ? 'success' : ''
    ].filter(Boolean).join(' ');

    return html`
      ${this.showLabel ? html`
        <label class="ls-input-label">
          ${this.label}
          ${this.required ? html`<span class="required">*</span>` : ''}
        </label>
      ` : ''}
      
      <input
        type="${this.type}"
        class="${inputClasses}"
        placeholder="${this.placeholder}"
        .value="${this.value}"
        name="${this.name}"
        ?disabled="${this.disabled}"
        ?required="${this.required}"
        @input="${this.handleInput}"
        @focus="${this.handleFocus}"
        @blur="${this.handleBlur}"
        hx-post="${this.hxPost}"
        hx-trigger="${this.hxTrigger}"
        hx-target="${this.hxTarget}"
      />
      
      ${this.helperText ? html`
        <div class="ls-input-helper">${this.helperText}</div>
      ` : ''}
      
      ${this.error && this.errorText ? html`
        <div class="ls-input-error-text">${this.errorText}</div>
      ` : ''}
    `;
  }
}
